---
import Galeria from "../components/Galeria.astro";
import { galleryItems, galleryLayout } from "../data/galleryData.js";
---

<section class="info-section section-container">
  <div class="two-column-layout">
    <div class="main-content">
      <h1>¡Bienvenidos a Britannia!</h1>
      <p class="subtitle">Un poco de historia.</p>

      <div class="history-text">
        <p>
          La comunidad de Britannia nace en el año 2017, cuando un usuario;
          ElGabyMC junto a su hermano Bondio. Crearon una ciudad en un servidor,
          Britannia.
        </p>
        <p>
          Rápidamente la ciudad formó amistades, invitando a gente la cuál fue
          importante en la formación de la comunidad. Pasaron muchos nombres y
          figuras en la ciudad, se destacan personas como: Moonky, daremill,
          DaxterRecord, DogGamer, Lunei, Deixol, Tioupi. Algunos aún siguen
          jugando.
        </p>
        <p>
          Estas personas serían fundamentales para crear el sentido de
          pertenencia y la personalidad de la ciudad, sin el aporte y el paso de
          estas personas sería difícil tener los principios actuales de la
          ciudad. Actualmente, en el año 2025, continuamos ese legado,
          manteniendo esos principios y fomentando la diversión en la comunidad.
        </p>
      </div>
    </div>
  </div>
</section>

<section class="gallery-title-section section-container">
  <h2 class="section-title">Britannia en Cococraft</h2>
</section>

<section class="gallery-section">
  <div class="section-container no-padding-y">
    <Galeria items={galleryItems} layout={galleryLayout} variant="hero" />
  </div>
</section>

<script>
  // Definir la interfaz para el elemento lightbox personalizado
  interface LightboxElement extends HTMLElement {
    open: () => void;
    setAttribute: (name: string, value: string) => void;
    getAttribute: (name: string) => string | null;
  }

  // Declarar la función en el ámbito global
  declare global {
    interface Window {
      openLightbox: (index: number) => void;
    }
  }

  function openLightbox(index: number) {
    const lightbox = document.querySelector(
      "lightbox-island",
    ) as LightboxElement | null;
    if (lightbox) {
      const layoutStr = lightbox.getAttribute("layout");
      const layout = layoutStr ? JSON.parse(layoutStr) : [];

      if (index > 0) {
        const clickedItem = layout.find((item: any) => item.index === index);
        if (clickedItem) {
          const newLayout = [
            layout[0], // Mantener el hero primero
            clickedItem, // Poner el ítem clickeado en segundo lugar
            ...layout.filter(
              (item: any) => item.index !== 0 && item.index !== index,
            ), // El resto
          ];
          lightbox.setAttribute("layout", JSON.stringify(newLayout));
        }
      }

      if (lightbox.open) {
        lightbox.open();
      } else {
        lightbox.setAttribute("open", "");
      }
    }
  }

  // Configurar los manejadores de eventos para los elementos de la galería
  document.addEventListener("DOMContentLoaded", () => {
    const galleryItems = document.querySelectorAll("[data-gallery-item]");
    galleryItems.forEach((item) => {
      item.addEventListener("click", (e) => {
        const index = parseInt(item.getAttribute("data-index") || "0", 10);
        openLightbox(index);
      });
    });
  });

  window.openLightbox = openLightbox;
</script>

<style>
  .info-section {
    padding-bottom: var(--space-md);
  }

  .no-padding-y {
    padding-top: 0;
    padding-bottom: 0;
  }

  .gallery-title-section {
    padding-top: var(--space-lg);
    padding-bottom: var(--space-sm);
  }

  .section-title {
    color: var(--color-primary);
    font-size: clamp(1.8rem, 4vw, 2.4rem);
    margin: 0;
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .two-column-layout {
    display: grid;
    grid-template-columns: 1fr;
    gap: var(--space-md);
    align-items: start;
  }

  .main-content {
    max-width: 860px;
    margin: 0 auto;
  }

  .main-content h1 {
    font-size: clamp(2rem, 5vw, 3.5rem);
    line-height: 1.1;
    margin-bottom: var(--space-sm);
    color: var(--color-primary);
    text-shadow: 0 0 30px rgba(255, 107, 0, 0.4);
  }

  .subtitle {
    font-size: clamp(1.1rem, 2.5vw, 1.4rem);
    font-weight: bold;
    margin-bottom: var(--space-md);
    opacity: 0.9;
  }

  .history-text {
    display: flex;
    flex-direction: column;
    gap: var(--space-sm);
  }

  .history-text p {
    font-size: clamp(1rem, 2.2vw, 1.1rem);
    line-height: 1.7;
    color: rgba(255, 255, 255, 0.85);
  }

  @media (min-width: 1024px) {
    .two-column-layout {
      grid-template-columns: 1fr; /* Keep it single column as per previous design but cleaner */
    }
  }
</style>

<script is:inline>
  window.addEventListener("DOMContentLoaded", () => {
    const gs = window.gsap;
    const ST = window.ScrollTrigger;
    if (!gs) return;

    const reveals = document.querySelectorAll(
      ".main-content > *, .section-title",
    );

    if (reveals.length && ST && gs.registerPlugin) {
      try {
        gs.registerPlugin(ST);
      } catch {}

      gs.set(reveals, { opacity: 0, y: 30 });

      reveals.forEach((el) => {
        gs.to(el, {
          opacity: 1,
          y: 0,
          duration: 0.8,
          ease: "power3.out",
          scrollTrigger: {
            trigger: el,
            start: "top 90%",
            once: true,
          },
        });
      });
    }
  });
</script>
