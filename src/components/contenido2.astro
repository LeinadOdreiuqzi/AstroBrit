---
import Skin from "../components/skin.astro";
import Contenido3 from "../components/contenido3.astro";
import Galeria from "../components/Galeria.astro";
import EnDesarrollo from "../components/EnDesarrollo.astro";

const mySkins = [
  {
    id: "my_first_skin1",
    skinPath: "/assets/Bondio.png",
    animation: "WaveAnimation",
    autoRotate: false,
    cameraLightIntensity: 2.0,
    globalLightIntensity: 2.5,
    cameraPositionX: 0,
    cameraPositionY: 15,
    cameraPositionZ: 60,
    cameraLookAtX: 0,
    cameraLookAtY: 10,
    cameraLookAtZ: 0,
  },
  {
    id: "my_first_skin2",
    skinPath: "/assets/paco.png",
    animation: "HitAnimation",
    autoRotate: false,
    cameraLightIntensity: 2.0,
    globalLightIntensity: 2.5,
    cameraPositionX: 0,
    cameraPositionY: 15,
    cameraPositionZ: 60,
    cameraLookAtX: 0,
    cameraLookAtY: 10,
    cameraLookAtZ: 0,
  },
  {
    id: "my_first_skin3",
    skinPath: "/assets/deivi.png",
    animation: "WaveAnimation",
    autoRotate: false,
    cameraLightIntensity: 2.0,
    globalLightIntensity: 2.5,
    cameraPositionX: 0,
    cameraPositionY: 15,
    cameraPositionZ: 60,
    cameraLookAtX: 0,
    cameraLookAtY: 10,
    cameraLookAtZ: 0,
  },
];

// Definir los elementos de la galería
const galleryItems = [
  {
    id: "hero-image",
    src: "/assets/Cocospawn.png",
    title: "EL CORAZÓN DE BRITANNIA",
    subtitle:
      "Los años pasan, pero el Ojo sigue siendo el símbolo eterno en el centro de la ciudad. Bajo su mirada incansable, Britannia se mantiene viva: veteranos y recién llegados se encuentran aquí para comenzar nuevas aventuras y fortalecer la historia de la comunidad. <br> Hay lugar para todos:  Los relatos compartidos entre amigos y las tradiciones que nos mantienen unidos cada año. El Ojo observa y protege, inspirando a todos los que pisan esta ciudad legendaria.",
  },
  {
    id: "gallery-1",
    src: "/assets/centroplots.png",
    title: "Centro de la ciudad",
    subtitle: "Centro de la ciudad",
  },
  {
    id: "gallery-2",
    src: "/assets/estatuaLaus.png",
    title: "Estatua de laus",
    subtitle: "",
  },
  {
    id: "gallery-3",
    src: "/assets/torrebrujo.png",
    title: "Torre del Brujo",
    subtitle: "Hogar del brujo",
  },
  {
    id: "gallery-4",
    src: "/assets/bar.png",
    title: "Bar",
    subtitle: "Área de recreación",
  },
  {
    id: "gallery-5",
    src: "/assets/dragones.png",
    title: "estatuas de dragones del antiguo spawn",
    subtitle: "Antiguo spawn",
  },
  {
    id: "gallery-6",
    src: "/assets/pollowow.png",
    title: "Algo esconde en su interior",
    subtitle: "pollo wow",
  },
  {
    id: "gallery-7",
    src: "/assets/dragones.png",
    title: "estatuas de dragones del antiguo spawn",
    subtitle: "Antiguo spawn",
  },
];

// Definir el layout personalizado para la galería
const galleryLayout = [
  { index: 0, className: "ms-3" }, // Imagen principal más grande
  { index: 1, className: "ms-2" }, // Imagen secundaria
  { index: 2, className: "ms-1" }, // Imagen pequeña
  { index: 3, className: "ms-2" }, // Imagen mediana
  { index: 4, className: "ms-1" }, // Imagen pequeña
  { index: 5, className: "ms-2" }, // Imagen mediana
];
---

<main>
  <header>
    <div class="logo-text"></div>
  </header>
  <div class="two-column-layout">
    <div class="left-column">
      <div class="main-content">
        <h1>¡Bienvenidos a Britannia!</h1>
        <p>Un poco de historia.</p>
        <p>
          La comunidad de Britannia nace en el año 2017, cuando un usuario;
          ElGabyMC junto a su hermano Bondio. Crearon una ciudad en un servidor,
          Britannia.
        </p>
        <p>
          Rápidamente la ciudad formó amistades, invitando a gente la cuál fue
          importante en la formación de la comunidad. Pasaron muchos nombres y
          figuras en la ciudad, se destacan personas como: Moonky, daremill,
          DaxterRecord, DogGamer, Lunei, Deixol, Tioupi. Algunos aún siguen
          jugando.
        </p>
        <p>
          Estas personas serían fundamentales para crear el sentido de
          pertenencia y la personalidad de la ciudad, sin el aporte y el paso de
          estas personas sería difícil tener los principios actuales de la
          ciudad. Actualmente, en el año 2025, continuamos ese legado,
          manteniendo esos principios y fomentando la diversión en la comunidad.
        </p>
      </div>
      <div class="skin-component">
        <Skin skinsToDisplay={mySkins} />
      </div>
    </div>
  </div>

  <h2
    style="text-align: left; padding-left: 250px; margin-bottom: 10px; color: #ff6b00; font-size: 2.0rem;"
  >
    Britannia en cococraft
  </h2>
  <!-- Sección de Galería 
  <section class="gallery-section" style="margin-top: 80px; padding: 0 20px;">
    <div class="gallery-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; padding: 20px 0;">
      {galleryItems.slice(1).map((item, index) => (
        <div 
          class="gallery-item" 
          style="
            position: relative; 
            overflow: hidden; 
            border-radius: 10px; 
            cursor: pointer;
            aspect-ratio: 4/3;
            transition: transform 0.3s ease;
          "
          data-gallery-item
          data-index={index + 1}
          class="gallery-item"
        >
          <img 
            src={item.src} 
            alt={item.title}
            style="
              width: 100%; 
              height: 100%; 
              object-fit: cover;
              transition: transform 0.3s ease;
            "
          />
          <div 
            style="
              position: absolute; 
              bottom: 0; 
              left: 0; 
              right: 0; 
              background: linear-gradient(transparent, rgba(0,0,0,0.7)); 
              padding: 15px;
              color: white;
            "
          >
            <h3 style="margin: 0 0 5px 0; font-size: 1.1rem;">{item.title}</h3>
            <p style="margin: 0; font-size: 0.9rem; opacity: 0.9;">{item.subtitle}</p>
          </div>
        </div>
      ))}
    </div>
  </section> !-->
</main>

<!-- Galería de Lightbox -->
<div>
  <Galeria items={galleryItems} layout={galleryLayout} variant="hero" />
</div>

<!-- Script para manejar la apertura del lightbox -->
<script>
  // Definir la interfaz para el elemento lightbox personalizado
  interface LightboxElement extends HTMLElement {
    open: () => void;
    setAttribute: (name: string, value: string) => void;
    getAttribute: (name: string) => string | null;
  }

  // Declarar la función en el ámbito global
  declare global {
    interface Window {
      openLightbox: (index: number) => void;
    }
  }

  function openLightbox(index: number) {
    const lightbox = document.querySelector(
      "lightbox-island",
    ) as LightboxElement | null;
    if (lightbox) {
      // Asegurarse de que el layout se mantenga pero resaltar el ítem clickeado
      const layout = JSON.parse(lightbox.getAttribute("layout") || "[]");
      // Reorganizar el layout para que el ítem clickeado sea el primero después del hero
      if (index > 0) {
        const clickedItem = layout.find((item: any) => item.index === index);
        if (clickedItem) {
          const newLayout = [
            layout[0], // Mantener el hero primero
            clickedItem, // Poner el ítem clickeado en segundo lugar
            ...layout.filter(
              (item: any) => item.index !== 0 && item.index !== index,
            ), // El resto
          ];
          lightbox.setAttribute("layout", JSON.stringify(newLayout));
        }
      }

      if (lightbox.open) {
        lightbox.open();
      } else {
        lightbox.setAttribute("open", "");
      }
    }
  }

  // Configurar los manejadores de eventos para los elementos de la galería
  document.addEventListener("DOMContentLoaded", () => {
    const galleryItems = document.querySelectorAll("[data-gallery-item]");
    galleryItems.forEach((item) => {
      item.addEventListener("click", (e) => {
        const index = parseInt(item.getAttribute("data-index") || "0", 10);
        openLightbox(index);
      });
    });
  });

  // Hacer la función accesible globalmente para compatibilidad
  window.openLightbox = openLightbox;
</script>

<div style="margin-top: 160px; position: relative; z-index: 101;">
  <EnDesarrollo />
</div>

<style>
  .gallery-item {
    transition:
      transform 0.3s ease,
      box-shadow 0.3s ease;
  }

  .gallery-item:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
  }

  .gallery-item img {
    transition: transform 0.3s ease;
  }

  .gallery-item:hover img {
    transform: scale(1.05);
  }

  .gallery-section {
    background: rgba(0, 0, 0, 0.2);
    padding: 40px 0;
    border-radius: 15px;
    margin: 60px 20px 0;
  }

  @media (max-width: 768px) {
    .gallery-grid {
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)) !important;
    }
  }

  .two-column-layout {
    display: grid;
    grid-template-columns: 1fr;
    gap: 16px;
    align-items: start;
    max-width: 1100px;
    margin: 0 auto;
    padding: 0 16px;
  }
  .left-column {
    display: flex;
    flex-direction: column;
    gap: 20px;
  }
  .main-content {
    max-width: 860px;
    margin: 0 auto;
  }
  .right-column img {
    width: 100%;
    height: auto;
    display: block;
    border-radius: 12px;
  }
  .skin-component {
    margin-top: 24px;
    width: 100%;
    max-width: 860px;
    margin-left: auto;
    margin-right: auto;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .skin-viewers-container {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    justify-content: center;
    gap: 16px;
    max-width: 860px;
    margin: 0 auto;
  }

  .main-content h1 {
    font-size: clamp(1.6rem, 3.6vw, 2.4rem);
    line-height: 1.2;
    margin: 0 0 8px;
  }
  .main-content p {
    font-size: clamp(0.95rem, 2.2vw, 1.05rem);
    line-height: 1.6;
  }

  @media (max-width: 1024px) {
    .two-column-layout {
      gap: 16px;
    }
  }
  @media (min-width: 1280px) {
    .two-column-layout {
      max-width: 1200px;
      gap: 18px;
    }
  }
  @media (max-width: 768px) {
    .two-column-layout {
      gap: 16px;
    }
    .main-content h1 {
      font-size: clamp(1.4rem, 6vw, 2rem);
    }
    .main-content p {
      font-size: clamp(0.9rem, 4.2vw, 1rem);
    }
  }
  @media (max-width: 480px) {
    .two-column-layout {
      gap: 12px;
    }
  }
</style>

<script is:inline>
  window.addEventListener("DOMContentLoaded", () => {
    const gs = window.gsap;
    const ST = window.ScrollTrigger;
    if (!gs) return;
    const mc = document.querySelector(".main-content");
    const skins = document.querySelector(".skin-component");

    const animateText = () => {
      if (!mc) return;
      const children = Array.from(mc.children);
      gs.to(children, {
        opacity: 1,
        y: 0,
        duration: 0.6,
        stagger: 0.08,
        ease: "power3.out",
      });
    };
    const animateSkins = () => {
      if (!skins) return;
      gs.to(skins, {
        opacity: 1,
        y: 0,
        scale: 1,
        duration: 0.7,
        ease: "power3.out",
      });
    };

    if (mc) gs.set(mc.children, { opacity: 0, y: 24 });
    if (skins) gs.set(skins, { opacity: 0, y: 24, scale: 0.98 });

    if (ST && gs.registerPlugin) {
      try {
        gs.registerPlugin(ST);
      } catch {}
      if (mc)
        gs.to(mc.children, {
          opacity: 1,
          y: 0,
          duration: 0.6,
          stagger: 0.08,
          ease: "power3.out",
          scrollTrigger: { trigger: mc, start: "top 80%", once: true },
        });
      if (skins)
        gs.to(skins, {
          opacity: 1,
          y: 0,
          scale: 1,
          duration: 0.7,
          ease: "power3.out",
          scrollTrigger: { trigger: skins, start: "top 80%", once: true },
        });
    } else {
      const io = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (!entry.isIntersecting) return;
            if (mc && entry.target === mc) animateText();
            if (skins && entry.target === skins) animateSkins();
            io.unobserve(entry.target);
          });
        },
        { threshold: 0.2 },
      );
      if (mc) io.observe(mc);
      if (skins) io.observe(skins);
    }
  });
</script>
